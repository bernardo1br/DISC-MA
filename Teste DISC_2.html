<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Questionário DISC – Forced Choice (Final)</title>
    <style>
        :root {
            --blue-main: #0072ce;
            --blue-light: #e1f0ff;
            --green-main: #22a447;
            --red-main: #d64545;
            --gray-bg: #f5f7fa;
            --gray-border: #d0d7e2;
            --text-main: #1f2933;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #ffffff;
            color: var(--text-main);
        }

        .app {
            max-width: 960px;
            margin: 0 auto;
            padding: 24px 16px 40px;
        }

        h1, h2, h3 {
            margin-top: 0;
            color: #102a43;
        }

        p {
            line-height: 1.5;
        }

        .intro-card {
            background: #ffffff;
            border-radius: 10px;
            border: 1px solid var(--gray-border);
            padding: 24px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }

        input[type="text"] {
            width: 100%;
            max-width: 420px;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid var(--gray-border);
            font-size: 0.95rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 9px 18px;
            border-radius: 999px;
            border: none;
            background: var(--blue-main);
            color: #ffffff;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            margin-top: 16px;
            transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.12);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: default;
            box-shadow: none;
        }

        .btn:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 7px rgba(0,0,0,0.18);
            background: #005bb0;
        }

        .btn-secondary {
            background: #ffffff;
            color: var(--blue-main);
            border: 1px solid var(--blue-main);
            box-shadow: none;
            margin-top: 16px; 
        }

        .btn-secondary:not(:disabled):hover {
            background: var(--blue-light);
            transform: translateY(-1px);
            box-shadow: 0 3px 7px rgba(0,0,0,0.08); 
        }
        
        .progress-bar-container {
            margin-bottom: 16px;
        }

        .progress-label {
            font-size: 0.9rem;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            color: #52606d;
        }

        .progress-track {
            width: 100%;
            height: 7px;
            background: #edf2f7;
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--blue-main), #44a8ff);
            transition: width 0.25s ease;
        }

        .block-card {
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid var(--gray-border);
            padding: 18px 18px 20px;
            margin-top: 8px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
            opacity: 0;
            transform: translateY(6px);
            animation: fadeInBlock 0.25s ease forwards;
        }

        @keyframes fadeInBlock {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .block-header {
            margin-bottom: 12px;
        }

        .block-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .block-subtitle {
            font-size: 0.86rem;
            color: #6b778c;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            grid-gap: 12px;
            margin-top: 12px;
            min-height: 100px;
        }
        
        .cards-grid .card.hidden {
            display: none !important;
        }

        .card {
            background: var(--gray-bg);
            border-radius: 10px;
            padding: 12px 12px 10px;
            border: 1px solid var(--gray-border);
            cursor: grab;
            font-size: 0.92rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 82px;
            transition: border 0.12s ease, box-shadow 0.12s ease, transform 0.12s ease, background 0.12s ease;
        }

        .card[draggable="true"]:active {
            cursor: grabbing;
        }

        .card.dragging {
            opacity: 0.85;
            transform: scale(1.03);
            box-shadow: 0 5px 14px rgba(15, 23, 42, 0.18);
            border-color: var(--blue-main);
        }

        .card-text {
            margin-bottom: 0;
            text-align: center;
        }

        .baskets-container {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            grid-gap: 12px;
            margin-top: 18px;
        }

        .basket {
            border-radius: 12px;
            padding: 12px 10px 10px;
            min-height: 86px;
            border: 2px dashed rgba(148,163,184,0.8);
            background: #ffffff; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            transition: border-color 0.12s ease, background 0.12s ease, box-shadow 0.12s ease;
            position: relative;
        }

        .basket-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .basket-label-dot {
            width: 9px;
            height: 9px;
            border-radius: 999px;
        }

        /* Estilos do cesto com a cor de destaque no fundo */
        .basket-more {
            border-color: rgba(34,164,71,0.5);
            background: #f0f9f3; /* Fundo verde claro */
        }

        .basket-less {
            border-color: rgba(214,69,69,0.45);
            background: #fdf2f2; /* Fundo vermelho claro */
        }

        .basket-more .basket-label-dot {
            background: var(--green-main);
        }

        .basket-less .basket-label-dot {
            background: var(--red-main);
        }

        .basket-hint {
            font-size: 0.78rem;
            color: #6b778c;
        }

        .basket.basket-active {
            box-shadow: 0 0 0 2px rgba(0,114,206,0.35);
        }

        .basket-card-wrapper {
            margin-top: 6px;
        }

        /* Estilo do card que está dentro do cesto */
        .basket-card-inner {
            background: #ffffff; 
            border-radius: 10px;
            border: 1px solid var(--gray-border);
            padding: 6px 8px 4px;
            font-size: 0.88rem;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 6px;
            /* Garante que o texto se alinhe bem */
            min-height: 40px; 
        }

        .basket-card-text {
            flex: 1;
        }

        .basket-card-remove {
            border: none;
            background: transparent;
            color: #9f1239;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0 4px;
        }

        .block-footer {
            margin-top: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .hint-text {
            font-size: 0.8rem;
            color: #6b778c;
        }

        .navigation-area {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-container {
            margin-top: 24px;
            background: #ffffff;
            border-radius: 12px;
            border: 1px solid var(--gray-border);
            padding: 20px 18px 26px;
        }

        .score-table {
            border-collapse: collapse;
            margin: 10px 0 16px;
            width: 100%;
            max-width: 480px;
            font-size: 0.9rem;
        }

        .score-table th, .score-table td {
            border: 1px solid #e1e4ea;
            padding: 4px 6px;
            text-align: center;
        }

        .score-table th {
            background: #f3f6fb;
        }

        .small-note {
            font-size: 0.8rem;
            color: #6b778c;
        }

        .report-header {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-bottom: 16px;
        }
        .report-title-main {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .report-subtitle {
            font-size: 0.86rem;
            color: #6b778c;
        }
        .report-participant {
            font-size: 0.9rem;
            margin-top: 4px;
        }
        .disc-layout-grid {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 3fr);
            gap: 16px;
            margin-top: 12px;
        }
        @media (max-width: 720px) {
            .disc-layout-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }
        .disc-summary-panel {
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            padding: 10px 12px;
            font-size: 0.86rem;
        }
        .disc-summary-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 6px;
        }
        .disc-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #0f172a;
            background: #e5e7eb;
        }
        .disc-chip-badge {
            width: 10px;
            height: 10px;
            border-radius: 999px;
        }
        .disc-chip.D .disc-chip-badge { background: #dc2626; }
        .disc-chip.I .disc-chip-badge { background: #facc15; }
        .disc-chip.S .disc-chip-badge { background: #22a447; }
        .disc-chip.C .disc-chip-badge { background: #2563eb; }
        .disc-chip-label {
            font-weight: 600;
        }
        .disc-summary-tag {
            font-size: 0.78rem;
            color: #6b7280;
        }
        .disc-summary-profiles {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            flex-wrap: wrap;
        }
        .disc-profile-card {
            display: inline-flex;
            align-items: flex-start;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            font-size: 0.8rem;
            max-width: 100%;
        }
        .disc-profile-label-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.74rem;
            font-weight: 600;
        }
        .disc-profile-label-badge.D {
            background: rgba(220,38,38,0.15);
            color: #991b1b;
        }
        .disc-profile-label-badge.I {
            background: rgba(250,204,21,0.18);
            color: #854d0e;
        }
        .disc-profile-label-badge.S {
            background: rgba(34,164,71,0.18);
            color: #14532d;
        }
        .disc-profile-label-badge.C {
            background: rgba(37,99,235,0.16);
            color: #1d4ed8;
        }
        .disc-profile-code {
            font-weight: 700;
            letter-spacing: 0.04em;
            margin-top: 2px;
        }
        .disc-profile-badges {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .disc-chart-panel {
            background: #f9fafb;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 12px 12px;
        }
        .disc-chart-title {
            font-size: 0.86rem;
            font-weight: 600;
            margin-bottom: 6px;
        }
        .disc-chart-legend {
            display: flex;
            gap: 12px;
            font-size: 0.78rem;
            color: #6b7280;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }
        .disc-legend-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .disc-legend-box {
            width: 10px;
            height: 10px;
            border-radius: 3px;
        }
        .disc-legend-box.natural {
            background: rgba(15,23,42,0.85);
        }
        .disc-legend-box.adapted {
            background: rgba(148,163,184,0.9);
        }
        .disc-chart-rows {
            margin-top: 4px;
        }
        .disc-factor-row {
            margin-bottom: 6px;
        }
        .disc-factor-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            margin-bottom: 2px;
            color: #374151;
        }
        .disc-factor-label strong {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .disc-factor-pill {
            padding: 1px 8px;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #0f172a;
            background: #e5e7eb;
        }
        .disc-factor-pill.D { background: rgba(220,38,38,0.16); color: #991b1b; }
        .disc-factor-pill.I { background: rgba(250,204,21,0.18); color: #854d0e; }
        .disc-factor-pill.S { background: rgba(34,164,71,0.18); color: #14532d; }
        .disc-factor-pill.C { background: rgba(37,99,235,0.16); color: #1d4ed8; }
        .disc-factor-bars {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .disc-bar-track {
            width: 100%;
            height: 7px;
            background: #e5e7eb;
            border-radius: 999px;
            overflow: hidden;
        }
        .disc-bar {
            height: 100%;
            border-radius: 999px;
            transition: width 0.25s ease;
        }
        .disc-bar.natural {
            background: rgba(15,23,42,0.9);
        }
        .disc-bar.adapted {
            background: rgba(148,163,184,0.95);
        }
        .disc-factor-scores {
            font-size: 0.75rem;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
            margin-top: 1px;
        }
        .disc-details-section {
            margin-top: 18px;
        }
        .disc-details-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }
        @media (max-width: 720px) {
            .disc-details-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }
        .disc-detail-card {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 12px;
            font-size: 0.86rem;
            background: #ffffff;
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .disc-detail-card::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 10px 0 0 10px;
        }
        .disc-detail-card.D::before { background: #dc2626; }
        .disc-detail-card.I::before { background: #facc15; }
        .disc-detail-card.S::before { background: #22a447; }
        .disc-detail-card.C::before { background: #2563eb; }
        .disc-detail-content {
            flex: 1;
        }
        .disc-detail-avatar {
            width: 28px;
            height: 28px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            color: #ffffff;
            flex-shrink: 0;
        }
        .disc-detail-avatar.D { background: #dc2626; }
        .disc-detail-avatar.I { background: #facc15; color: #713f12; }
        .disc-detail-avatar.S { background: #22a447; }
        .disc-detail-avatar.C { background: #2563eb; }
        .disc-detail-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .disc-detail-body p {
            margin: 4px 0;
        }
        .disc-detail-body em {
            font-size: 0.78rem;
            color: #6b7280;
        }
        .disc-footer-note {
            margin-top: 14px;
            font-size: 0.78rem;
            color: #6b7280;
        }

        .disc-graphs-wrapper {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 14px;
            margin-top: 6px;
        }
        @media (max-width: 720px) {
            .disc-graphs-wrapper {
                grid-template-columns: minmax(0, 1fr);
            }
        }
        .disc-single-graph {
            background: #ffffff;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 10px 10px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }
        .disc-graph-header {
            text-align: center;
            margin-bottom: 6px;
        }
        .disc-graph-title {
            font-size: 0.88rem;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .disc-graph-subtitle {
            font-size: 0.74rem;
            color: #6b7280;
        }
        .disc-graph-bars-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 8px;
            height: 120px;
            margin: 4px 2px 0;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 4px;
        }
        .disc-graph-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 100%;
        }
        .disc-graph-bar-inner {
            width: 70%;
            border-radius: 6px 6px 0 0;
            background: #d1d5db;
            min-height: 4px;
            transition: height 0.25s ease;
        }
        .disc-graph-bar-inner.D {
            background: #dc2626;
        }
        .disc-graph-bar-inner.I {
            background: #facc15;
        }
        .disc-graph-bar-inner.S {
            background: #22a447;
        }
        .disc-graph-bar-inner.C {
            background: #2563eb;
        }
        .disc-graph-bar-label {
            font-size: 0.75rem;
            margin-top: 2px;
            font-weight: 600;
        }
        .disc-graph-values-row {
            display: flex;
            justify-content: space-between;
            gap: 6px;
            margin-top: 6px;
        }
        .disc-factor-circle {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid #e5e7eb;
            color: #111827;
            background: #f9fafb;
        }
        .disc-factor-circle.D {
            border-color: rgba(220,38,38,0.6);
            background: rgba(254,242,242,0.9);
            color: #991b1b;
        }
        .disc-factor-circle.I {
            border-color: rgba(250,204,21,0.7);
            background: rgba(254,252,232,0.95);
            color: #854d0e;
        }
        .disc-factor-circle.S {
            border-color: rgba(34,164,71,0.6);
            background: rgba(240,253,244,0.95);
            color: #14532d;
        }
        .disc-factor-circle.C {
            border-color: rgba(37,99,235,0.7);
            background: rgba(239,246,255,0.95);
            color: #1d4ed8;
        }
        .disc-comm-section {
            margin-top: 20px;
        }
        .disc-comm-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            margin-top: 8px;
        }
        @media (max-width: 720px) {
            .disc-comm-grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }
        .disc-comm-card {
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            padding: 10px 12px;
            background: #ffffff;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }
        .disc-comm-card.D {
            border-left: 4px solid #dc2626;
        }
        .disc-comm-card.I {
            border-left: 4px solid #facc15;
        }
        .disc-comm-card.S {
            border-left: 4px solid #22a447;
        }
        .disc-comm-card.C {
            border-left: 4px solid #2563eb;
        }
        .disc-comm-avatar {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            color: #ffffff;
            flex-shrink: 0;
        }
        .disc-comm-avatar.D {
            background: #dc2626;
        }
        .disc-comm-avatar.I {
            background: #facc15;
            color: #713f12;
        }
        .disc-comm-avatar.S {
            background: #22a447;
        }
        .disc-comm-avatar.C {
            background: #2563eb;
        }
        .disc-comm-body {
            flex: 1;
        }
        .disc-comm-title {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }
        .disc-comm-subtitle {
            font-size: 0.78rem;
            color: #6b7280;
            margin-bottom: 4px;
        }
        .disc-comm-list {
            font-size: 0.8rem;
            margin: 0;
            padding-left: 16px;
        }
        .disc-comm-list li {
            margin-bottom: 2px;
        }

        @media (max-width: 720px) {
            .cards-grid {
                grid-template-columns: minmax(0, 1fr);
            }
            .baskets-container {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        /* Touch interaction overlays and touch cards */
        .touch-card {
            cursor: pointer;
        }
        .touch-choice-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15,23,42,0.45);
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 9999;
        }
        .touch-choice-sheet {
            background: #ffffff;
            border-radius: 16px 16px 0 0;
            padding: 12px 16px 16px;
            width: 100%;
            max-width: 480px;
            box-shadow: 0 -4px 18px rgba(15,23,42,0.35);
        }
        .touch-choice-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .touch-choice-sub {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 8px;
        }
        .touch-choice-buttons {
            display: flex;
            gap: 8px;
        }
        .touch-choice-btn {
            flex: 1;
            padding: 10px 0;
            border-radius: 999px;
            border: none;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .touch-choice-btn-more {
            background: #f0f9f3;
            color: #14532d;
        }
        .touch-choice-btn-less {
            background: #fdf2f2;
            color: #991b1b;
        }
    </style>
</head>
<body>
<div class="app">
    <section id="introSection" class="intro-card">
        <h1>Mapa DISC – Estilo de Funcionamento</h1>
        <p>
            Este instrumento apresenta situações breves do dia a dia. Em cada conjunto, arraste a afirmação que
            <strong>mais</strong> se parece com você para o cesto "Mais eu" e a que <strong>menos</strong> se parece
            com você para o cesto "Menos eu".
        </p>
        <p>
            Não há respostas certas ou erradas. Responda com espontaneidade, seguindo sua <strong>intuição</strong> e
            seu modo natural de agir, sem tentar buscar o que seria "ideal" ou "esperado".
        </p>
        <label for="nome">Nome da pessoa avaliada:</label>
        <input type="text" id="nome" placeholder="Digite o nome completo" required>
        <button class="btn" id="startBtn">Iniciar</button>
    </section>

    <section id="questionSection" style="display:none;">
        <div class="progress-bar-container">
            <div class="progress-label">
                <span id="progressText"></span>
               
                <span id="progressPercent"></span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div id="blockContainer"></div>
    </section>

    <section id="reportSection" style="display:none;">
        <div class="report-container" id="reportContainer"></div>
      
        <div style="margin-top:14px;">
            <button class="btn" onclick="window.print()">Salvar como PDF (imprimir)</button>
        </div>
    </section>
</div>

<script>
    // ----------------------------------------------------
    // Dados dos blocos (Mantidos Inalterados)
    // ----------------------------------------------------
    const blocks = [
        {
            id: 1,
            items: [
                { factor: 'D', profile: 'N', text: 'Quando estou com amigos decidindo o que fazer, costumo assumir rapidamente uma direção para o grupo.' },
                { factor: 'I', profile: 'N', text: 'Em encontros sociais, eu naturalmente puxo conversa e incentivo as pessoas a se entrosarem.' },
                { factor: 'S', profile: 'A', text: 'Mesmo fora do trabalho, procuro evitar discussões mais fortes para manter um clima tranquilo.' },
                { factor: 'C', profile: 'A', text: 'Em situações simples do dia a dia, gosto de ter alguma lógica ou ordem na forma como organizo as coisas.' }
            ]
        },
        {
            id: 2,
            items: [
                { factor: 'D', profile: 'A', text: 'Em uma reunião de trabalho com opiniões diferentes, costumo propor rapidamente um caminho para decidir.' },
                { factor: 'I', profile: 'A', text: 'Em reuniões, busco deixar o ambiente leve, fazendo conexões entre as pessoas e estimulando a participação.' },
                { factor: 'S', profile: 'N', text: 'Quando o clima de uma conversa fica tenso, eu tento ouvir com calma e ajudar a acalmar os ânimos.' },
                { factor: 'C', profile: 'N', text: 'Quando preciso opinar numa decisão, gosto de entender antes os critérios e informações disponíveis.' }
            ]
        },
        {
            id: 3,
            items: [
                { factor: 'D', profile: 'N', text: 'Ao perceber que algo não está funcionando bem na minha rotina, tomo decisões rápidas para ajustar.' },
                { factor: 'I', profile: 'A', text: 'Quando alguém propõe uma nova ideia para o grupo, costumo demonstrar entusiasmo e reforçar os pontos positivos.' },
                { factor: 'S', profile: 'N', text: 'Prefiro seguir um ritmo relativamente constante nas minhas atividades pessoais, sem muitas mudanças bruscas.' },
                { factor: 'C', profile: 'A', text: 'Antes de mudar algo importante, gosto de pensar nas possíveis consequências e em como organizar a mudança.' }
            ]
        },
        {
            id: 4,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando aparece um prazo curto no trabalho, priorizo rapidamente o que precisa ser feito e vou direto ao ponto.' },
                { factor: 'I', profile: 'N', text: 'Sob pressão, ainda assim tento manter o bom relacionamento com as pessoas envolvidas.' },
                { factor: 'S', profile: 'A', text: 'Quando o volume de tarefas aumenta, busco manter a calma e seguir um passo de cada vez.' },
                { factor: 'C', profile: 'N', text: 'Diante de demandas urgentes, ainda procuro assegurar que o mínimo de qualidade e critério seja mantido.' }
            ]
        },
        {
            id: 5,
            items: [
                { factor: 'D', profile: 'N', text: 'Se alguém demora muito para decidir algo simples comigo, tenho tendência a sugerir logo uma opção para resolver.' },
                { factor: 'I', profile: 'N', text: 'Quando amigos estão desanimados, costumo usar humor ou conversa para levantar o astral do grupo.' },
                { factor: 'S', profile: 'A', text: 'Em situações cotidianas, prefiro manter acordos informais estáveis do que ficar mudando de combinação o tempo todo.' },
                { factor: 'C', profile: 'A', text: 'Quando combino algo, gosto de alinhar minimamente horários e detalhes para evitar desencontros.' }
            ]
        },
        {
            id: 6,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando a empresa anuncia mudanças, tenho impulso de entender rapidamente o impacto e defender minha posição.' },
                { factor: 'I', profile: 'A', text: 'Em momentos de mudança no trabalho, procuro conversar com colegas para explicar, acalmar e engajar.' },
                { factor: 'S', profile: 'N', text: 'Diante de mudanças organizacionais, costumo observar, assimilar e ir ajustando meu modo de trabalhar aos poucos.' },
                { factor: 'C', profile: 'N', text: 'Quando há uma nova regra ou processo, busco entender com clareza o que mudou e como deve ser seguido.' }
            ]
        },
        {
            id: 7,
            items: [
                { factor: 'D', profile: 'N', text: 'Se um grupo está indefinido sobre onde ir ou o que fazer, tenho facilidade em encerrar a discussão com uma decisão.' },
                { factor: 'I', profile: 'A', text: 'Em atividades de lazer em grupo, gosto de envolver todos, sugerindo opções e incentivando a participação.' },
                { factor: 'S', profile: 'N', text: 'Em momentos de descanso, prefiro ambientes tranquilos e previsíveis do que experiências muito agitadas.' },
                { factor: 'C', profile: 'A', text: 'Mesmo em programas informais, costumo prestar atenção em horários e pequenas combinações acordadas.' }
            ]
        },
        {
            id: 8,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando discordo do modo como algo está sendo feito no trabalho, sinto facilidade em expor minha opinião diretamente.' },
                { factor: 'I', profile: 'N', text: 'Em divergências profissionais, costumo usar diálogo e empatia para aproximar as pessoas envolvidas.' },
                { factor: 'S', profile: 'A', text: 'Quando surge conflito no trabalho, procuro ouvir todos com calma e buscar uma solução que preserve as relações.' },
                { factor: 'C', profile: 'N', text: 'Em desacordos profissionais, gosto de trazer fatos, dados ou regras para fundamentar o caminho sugerido.' }
            ]
        },
        {
            id: 9,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando tenho várias tarefas competindo por prioridade, escolho rapidamente o que atacar primeiro e começo a executar.' },
                { factor: 'I', profile: 'N', text: 'Mesmo com muitas demandas, mantenho contato com as pessoas para alinhar expectativas e pedir apoio quando preciso.' },
                { factor: 'S', profile: 'A', text: 'Em períodos de alta demanda, procuro organizar uma sequência estável de trabalho para não perder o foco.' },
                { factor: 'C', profile: 'N', text: 'Quando acumulo tarefas, costumo listar ou organizar de algum modo para não esquecer pontos importantes.' }
            ]
        },
        {
            id: 10,
            items: [
                { factor: 'D', profile: 'N', text: 'Ao tomar decisões pessoais que só dependem de mim, costumo escolher sem demorar muito.' },
                { factor: 'I', profile: 'A', text: 'Quando tenho tempo livre, gosto de combinar atividades que envolvam interação com outras pessoas.' },
                { factor: 'S', profile: 'N', text: 'Em decisões simples do dia a dia, prefiro manter hábitos e rotinas que já funcionam bem para mim.' },
                { factor: 'C', profile: 'A', text: 'Mesmo em escolhas pessoais, penso se a opção faz sentido a longo prazo e se está alinhada com o que planejei.' }
            ]
        },
        {
            id: 11,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando participo de um projeto em equipe, tenho facilidade em direcionar o grupo para objetivos claros.' },
                { factor: 'I', profile: 'A', text: 'Em projetos em grupo, costumo estimular trocas, valorizar contribuições e conectar as pessoas entre si.' },
                { factor: 'S', profile: 'N', text: 'Quando trabalho em equipe, busco ser consistente, confiável e manter um clima de cooperação.' },
                { factor: 'C', profile: 'N', text: 'Em trabalhos conjuntos, fico atento(a) à qualidade, aos detalhes e à aderência ao que foi combinado.' }
            ]
        },
        {
            id: 12,
            items: [
                { factor: 'D', profile: 'N', text: 'Quando algo inesperado acontece na minha vida pessoal, costumo agir rapidamente para resolver o essencial.' },
                { factor: 'I', profile: 'A', text: 'Diante de contratempos pessoais, gosto de conversar com alguém de confiança para aliviar e pensar em alternativas.' },
                { factor: 'S', profile: 'N', text: 'Em imprevistos, procuro manter a calma e adaptar minha rotina sem grandes sobressaltos.' },
                { factor: 'C', profile: 'A', text: 'Quando algo foge do planejado, avalio o que precisa ser reorganizado para minimizar impactos futuros.' }
            ]
        },
        {
            id: 13,
            items: [
                { factor: 'D', profile: 'A', text: 'Quando considero uma regra pouco prática, sinto impulso de questioná-la e propor algo mais direto.' },
                { factor: 'I', profile: 'N', text: 'Ao lidar com normas, procuro conversar para entender como as pessoas estão vivendo essas exigências.' },
                { factor: 'S', profile: 'A', text: 'Quando há muitas regras, busco segui-las de forma estável, para evitar problemas e surpresas.' },
                { factor: 'C', profile: 'N', text: 'Costumo ler orientações e procedimentos com atenção para entender como devo cumprir o que está previsto.' }
            ]
        },
        {
            id: 14,
            items: [
                { factor: 'D', profile: 'N', text: 'Quando tenho tempo livre, às vezes escolho atividades que me desafiam ou me tiram da zona de conforto.' },
                { factor: 'I', profile: 'N', text: 'Em momentos de lazer, gosto de estar em contato com pessoas, mesmo que seja em ambientes informais.' },
                { factor: 'S', profile: 'A', text: 'Quando encontro uma rotina que me faz bem, tendo a mantê-la por bastante tempo.' },
                { factor: 'C', profile: 'A', text: 'Em decisões pessoais, considero prós e contras antes de assumir um compromisso maior.' }
            ]
        },
        {
            id: 15,
            items: [
                { factor: 'D', profile: 'A', text: 'Se sou responsável por algo importante no trabalho, sinto conforto em tomar decisões firmes quando necessário.' },
                { factor: 'I', profile: 'A', text: 'Quando preciso influenciar uma decisão crítica, uso argumentos, exemplos e diálogo para convencer.' },
                { factor: 'S', profile: 'N', text: 'Em situações relevantes, busco ouvir diferentes pontos de vista antes de apoiar uma decisão final.' },
                { factor: 'C', profile: 'N', text: 'Em decisões importantes, dou peso significativo aos dados, evidências e possíveis riscos envolvidos.' }
            ]
        },
        {
            id: 16,
            items: [
                { factor: 'D', profile: 'N', text: 'Em conversas em que opiniões se chocam, tenho facilidade em sustentar meu ponto de vista com firmeza.' },
                { factor: 'I', profile: 'N', text: 'Em situações de grupo, costumo facilitar o diálogo e tentar manter todos à vontade.' },
                { factor: 'S', profile: 'A', text: 'Quando uma convivência se torna tensa, eu prefiro agir com cautela e buscar restabelecer um ambiente mais harmonioso.' },
                { factor: 'C', profile: 'A', text: 'Em discussões mais acaloradas, procuro trazer clareza, organizar ideias e distinguir fatos de opiniões.' }
            ]
        }
    ];

    // ----------------------------------------------------
    // Variáveis de Estado
    // ----------------------------------------------------
    let currentBlockIndex = 0; // 0..15
    let selections = []; // [{ moreIndex, lessIndex }]
    let participantName = '';
    const basketElements = {};
    // Referência global para o botão "Avançar" do bloco atual
    let currentAdvanceButton = null;

    // ----------------------------------------------------
    // Elementos DOM
    // ----------------------------------------------------
    const introSection = document.getElementById('introSection');
    const questionSection = document.getElementById('questionSection');
    const reportSection = document.getElementById('reportSection');

    const progressText = document.getElementById('progressText');
    const progressPercent = document.getElementById('progressPercent');
    const progressFill = document.getElementById('progressFill');
    const blockContainer = document.getElementById('blockContainer');
    const reportContainer = document.getElementById('reportContainer');
    const nameInput = document.getElementById('nome');

    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;

    // ----------------------------------------------------
    // Funções de Inicialização
    // ----------------------------------------------------
    document.getElementById('startBtn').addEventListener('click', () => {
        const nomeVal = (nameInput.value || '').trim();
        if (!nomeVal) {
            alert('Informe o nome da pessoa avaliada para iniciar.');
            nameInput.focus();
            return;
        }
        participantName = nomeVal;
        introSection.style.display = 'none';
        questionSection.style.display = 'block';

        currentBlockIndex = 0;
        renderCurrentBlock();
    });

    // ----------------------------------------------------
    // Função Principal de Renderização
    // ----------------------------------------------------
    function renderCurrentBlock() {
        const totalBlocks = blocks.length;
        const blockNumber = currentBlockIndex + 1;
        const percent = Math.round((currentBlockIndex) / totalBlocks * 100);

        progressText.textContent = `Bloco ${blockNumber} de ${totalBlocks}`;
        progressPercent.textContent = `${percent}%`;
        progressFill.style.width = `${percent}%`;

        const block = blocks[currentBlockIndex];
        const initialSelection = selections[currentBlockIndex] || { moreIndex: null, lessIndex: null };
        const blockSelection = { ...initialSelection }; // Clone local

        blockContainer.innerHTML = '';

        const blockEl = document.createElement('div');
        blockEl.className = 'block-card';

        // Header
        const headerEl = document.createElement('div');
        headerEl.className = 'block-header';
        const titleEl = document.createElement('div');
        titleEl.className = 'block-title';
        titleEl.textContent = `Situação ${blockNumber}`;
        const subtitleEl = document.createElement('div');
        subtitleEl.className = 'block-subtitle';
        subtitleEl.textContent = 'Arraste a afirmação que MAIS se parece com você e a que MENOS se parece com você para as caixas abaixo.';
        headerEl.appendChild(titleEl);
        headerEl.appendChild(subtitleEl);

        // Cards Grid
        const cardsGrid = document.createElement('div');
        cardsGrid.className = 'cards-grid';

        // Permitir drop no grupo de cards para "devolver" cards dos cestos
        cardsGrid.addEventListener('dragover', (e) => {
            e.preventDefault();
        });
        cardsGrid.addEventListener('drop', (e) => {
            e.preventDefault();
            const data = e.dataTransfer.getData('text/plain');
            const index = parseInt(data, 10);
            if (isNaN(index)) return;

            // Se o índice estiver em algum cesto, remove a seleção e devolve ao grupo
            if (blockSelection.moreIndex === index) {
                blockSelection.moreIndex = null;
            }
            if (blockSelection.lessIndex === index) {
                blockSelection.lessIndex = null;
            }
            updateAllUI(blockSelection, block);
        });

        const indices = block.items.map((_, idx) => idx);
        for (let i = indices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [indices[i], indices[j]] = [indices[j], indices[i]];
        }

        indices.forEach((idx) => {
            const item = block.items[idx];
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.itemIndex = idx.toString();
            card.id = `card-${currentBlockIndex}-${idx}`;

            const textEl = document.createElement('div');
            textEl.className = 'card-text';
            textEl.textContent = item.text;

            card.appendChild(textEl);

            if (isTouchDevice) {
                card.classList.add('touch-card');
                card.addEventListener('click', () => {
                    openTouchChoice(idx, item.text, blockSelection, block);
                });
            } else {
                card.setAttribute('draggable', 'true');
                card.addEventListener('dragstart', (e) => {
                    card.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', idx.toString());
                });
                card.addEventListener('dragend', () => {
                    card.classList.remove('dragging');
                });
            }

            cardsGrid.appendChild(card);
        });

        // Baskets Container
        const basketsContainer = document.createElement('div');
        basketsContainer.className = 'baskets-container';

        basketElements.more = createBasketElement('Mais eu', 'basket-more');
        basketElements.less = createBasketElement('Menos eu', 'basket-less');

        setupBasketDrop(basketElements.more, 'more', blockSelection, block);
        setupBasketDrop(basketElements.less, 'less', blockSelection, block);

        basketsContainer.appendChild(basketElements.more.container);
        basketsContainer.appendChild(basketElements.less.container);

        // Footer e Navegação
        const footerEl = document.createElement('div');
        footerEl.className = 'block-footer';

        const hintEl = document.createElement('div');
        hintEl.className = 'hint-text';
        hintEl.textContent = 'Arraste os cartões para os cestos. Você pode arrastar de volta para o grupo ou usar o botão Desfazer.';

        const navArea = document.createElement('div');
        navArea.className = 'navigation-area';

        // Botão de Voltar
        const backBtn = document.createElement('button');
        backBtn.className = 'btn btn-secondary';
        backBtn.textContent = 'Voltar';
        backBtn.disabled = currentBlockIndex === 0;
        backBtn.addEventListener('click', () => {
            if (currentBlockIndex > 0) {
                currentBlockIndex -= 1;
                blockContainer.style.opacity = '0';
                setTimeout(() => {
                    renderCurrentBlock();
                    blockContainer.style.opacity = '1';
                }, 150);
            }
        });

        // Botão "Desfazer tudo" (devolve os dois cards ao grupo)
        const undoAllBtn = document.createElement('button');
        undoAllBtn.className = 'btn btn-secondary';
        undoAllBtn.type = 'button';
        undoAllBtn.textContent = 'Desfazer alocações';
        undoAllBtn.addEventListener('click', () => {
            blockSelection.moreIndex = null;
            blockSelection.lessIndex = null;
            updateAllUI(blockSelection, block);
        });

        // Botão de Avançar
        const advanceBtn = document.createElement('button');
        advanceBtn.className = 'btn';
        advanceBtn.id = 'advanceBtn';
        advanceBtn.textContent = blockNumber === totalBlocks ?
            'Concluir e gerar relatório' : 'Avançar';
        advanceBtn.disabled = true;
        advanceBtn.addEventListener('click', () => {
            if (blockSelection.moreIndex === null || blockSelection.lessIndex === null) return;

            // Salva a seleção no array de estado
            selections[currentBlockIndex] = {
                moreIndex: blockSelection.moreIndex,
                lessIndex: blockSelection.lessIndex
            };

            if (currentBlockIndex < totalBlocks - 1) {
                currentBlockIndex += 1;
                blockContainer.style.opacity = '0';
                setTimeout(() => {
                    renderCurrentBlock();
                    blockContainer.style.opacity = '1';
                }, 150);
            } else {
                generateReport();
            }
        });

        // Guarda referência global do botão de avançar
        currentAdvanceButton = advanceBtn;

        if (currentBlockIndex > 0) {
            navArea.appendChild(backBtn);
        }
        navArea.appendChild(advanceBtn);

        footerEl.appendChild(hintEl);
        footerEl.appendChild(undoAllBtn);
        footerEl.appendChild(navArea);

        blockEl.appendChild(headerEl);
        blockEl.appendChild(cardsGrid);
        blockEl.appendChild(basketsContainer);
        blockEl.appendChild(footerEl);

        blockContainer.appendChild(blockEl);

        // Atualiza o estado inicial dos cestos e cards
        updateAllUI(blockSelection, block);
    }

    // ----------------------------------------------------
    // Funções de Gerenciamento de Estado e UI
    // ----------------------------------------------------

    // Esconde o card da grade original quando selecionado
    function updateCardUI(blockSelection, block) {
        const cards = document.querySelectorAll('.cards-grid .card');
        const { moreIndex, lessIndex } = blockSelection;

        cards.forEach(card => {
            const index = parseInt(card.dataset.itemIndex, 10);

            if (index === moreIndex || index === lessIndex) {
                card.classList.add('hidden');
            } else {
                card.classList.remove('hidden');
            }

            // O card só é draggable se NÃO estiver selecionado
            card.setAttribute('draggable', !(index === moreIndex || index === lessIndex));
        });
    }

    // Atualiza o conteúdo visual dos cestos E o estado do botão "Avançar"
    function updateBasketUI(blockSelection, block) {
        basketElements.more.refreshBasket(blockSelection, block, 'more');
        basketElements.less.refreshBasket(blockSelection, block, 'less');

        // Atualiza estado do botão Avançar com base nas duas seleções
        updateAdvanceButtonState(blockSelection, currentAdvanceButton);
    }

    // Função mestre para atualizar toda a UI de seleção
    function updateAllUI(blockSelection, block) {
        updateCardUI(blockSelection, block);
        updateBasketUI(blockSelection, block);
    }

    // Garante que o botão Avançar só ative após as duas caixas estarem preenchidas
    function updateAdvanceButtonState(blockSelection, advanceBtn) {
        if (advanceBtn) {
            advanceBtn.disabled = !(blockSelection.moreIndex !== null && blockSelection.lessIndex !== null);
        }
    }

    // Touch overlay for card selection on touch devices
    function openTouchChoice(idx, text, blockSelection, block) {
        // Se o card já estiver em um dos cestos, um novo toque limpa a seleção
        if (blockSelection.moreIndex === idx || blockSelection.lessIndex === idx) {
            if (blockSelection.moreIndex === idx) blockSelection.moreIndex = null;
            if (blockSelection.lessIndex === idx) blockSelection.lessIndex = null;
            updateAllUI(blockSelection, block);
            return;
        }

        const overlay = document.createElement('div');
        overlay.className = 'touch-choice-overlay';

        const sheet = document.createElement('div');
        sheet.className = 'touch-choice-sheet';

        const titleEl = document.createElement('div');
        titleEl.className = 'touch-choice-title';
        titleEl.textContent = 'Como esta afirmação se parece com você?';

        const subEl = document.createElement('div');
        subEl.className = 'touch-choice-sub';
        subEl.textContent = text;

        const buttonsRow = document.createElement('div');
        buttonsRow.className = 'touch-choice-buttons';

        const btnMore = document.createElement('button');
        btnMore.type = 'button';
        btnMore.className = 'touch-choice-btn touch-choice-btn-more';
        btnMore.textContent = 'Mais eu';

        const btnLess = document.createElement('button');
        btnLess.type = 'button';
        btnLess.className = 'touch-choice-btn touch-choice-btn-less';
        btnLess.textContent = 'Menos eu';

        btnMore.addEventListener('click', () => {
            if (blockSelection.lessIndex === idx) blockSelection.lessIndex = null;
            blockSelection.moreIndex = idx;
            document.body.removeChild(overlay);
            updateAllUI(blockSelection, block);
        });

        btnLess.addEventListener('click', () => {
            if (blockSelection.moreIndex === idx) blockSelection.moreIndex = null;
            blockSelection.lessIndex = idx;
            document.body.removeChild(overlay);
            updateAllUI(blockSelection, block);
        });

        buttonsRow.appendChild(btnMore);
        buttonsRow.appendChild(btnLess);
        sheet.appendChild(titleEl);
        sheet.appendChild(subEl);
        sheet.appendChild(buttonsRow);
        overlay.appendChild(sheet);

        // Fechar ao tocar fora do painel
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                document.body.removeChild(overlay);
            }
        });

        document.body.appendChild(overlay);
    }

    // Criação do Cesto (Basket) - inclui lógica de "Desfazer" e drag de volta
    function createBasketElement(labelText, basketClass) {
        const container = document.createElement('div');
        container.className = 'basket ' + basketClass;

        const label = document.createElement('div');
        label.className = 'basket-label';

        const dot = document.createElement('div');
        dot.className = 'basket-label-dot';
        const labelSpan = document.createElement('span');
        labelSpan.textContent = labelText;

        label.appendChild(dot);
        label.appendChild(labelSpan);

        const hint = document.createElement('div');
        hint.className = 'basket-hint';
        hint.textContent = 'Arraste um cartão para cá.';

        const cardWrapper = document.createElement('div');
        cardWrapper.className = 'basket-card-wrapper';

        container.appendChild(label);
        container.appendChild(hint);
        container.appendChild(cardWrapper);

        container.refreshBasket = function(blockSelection, block, type) {
            const currentIndex = type === 'more'
                ? blockSelection.moreIndex
                : blockSelection.lessIndex;

            cardWrapper.innerHTML = '';

            if (currentIndex === null) {
                hint.style.display = 'block';
                return;
            }
            hint.style.display = 'none';

            const cardInner = document.createElement('div');
            cardInner.className = 'basket-card-inner';

            if (!isTouchDevice) {
                cardInner.setAttribute('draggable', 'true');
                // Permitir arrastar o card do cesto de volta para o grupo de cards
                cardInner.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', currentIndex.toString());
                    cardInner.classList.add('dragging');
                });
                cardInner.addEventListener('dragend', () => {
                    cardInner.classList.remove('dragging');
                });
            }

            const textEl = document.createElement('div');
            textEl.className = 'basket-card-text';
            textEl.textContent = block.items[currentIndex].text;

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'basket-card-remove';
            removeBtn.textContent = 'Desfazer';
            removeBtn.setAttribute('aria-label', `Desfazer seleção ${labelText}`);

            // Ação de Desfazer: move o card de volta para o pool
            removeBtn.addEventListener('click', () => {
                if (type === 'more') {
                    blockSelection.moreIndex = null;
                } else {
                    blockSelection.lessIndex = null;
                }
                updateAllUI(blockSelection, block);
            });

            cardInner.appendChild(textEl);
            cardInner.appendChild(removeBtn);
            cardWrapper.appendChild(cardInner);
        };

        return { container, hint, cardWrapper, refreshBasket: container.refreshBasket };
    }

    // Configuração do Drop nos Cestos
    function setupBasketDrop(basketObj, type, blockSelection, block) {
        const container = basketObj.container;
        container.addEventListener('dragover', (e) => {
            e.preventDefault();
            container.classList.add('basket-active');
        });
        container.addEventListener('dragleave', () => {
            container.classList.remove('basket-active');
        });
        container.addEventListener('drop', (e) => {
            e.preventDefault();
            container.classList.remove('basket-active');
            const data = e.dataTransfer.getData('text/plain');
            const index = parseInt(data, 10);
            if (isNaN(index)) return;

            setSelection(type, index, blockSelection, block);
        });
    }

    // Configuração de Seleção
    function setSelection(type, index, blockSelection, block) {
        if (type === 'more') {
            if (blockSelection.lessIndex === index) {
                blockSelection.lessIndex = null;
            }
            blockSelection.moreIndex = index;
        } else {
            if (blockSelection.moreIndex === index) {
                blockSelection.moreIndex = null;
            }
            blockSelection.lessIndex = index;
        }

        updateAllUI(blockSelection, block);
    }

    // ----------------------------------------------------
    // Função de Geração de Relatório (Atualizada - escala 0 a 100)
    // ----------------------------------------------------
    function generateReport() {
        questionSection.style.display = 'none';
        reportSection.style.display = 'block';

        const scoresNatural = { D: 0, I: 0, S: 0, C: 0 };
        const scoresAdapted = { D: 0, I: 0, S: 0, C: 0 };

        // Count the number of items per factor/profile
        const countsNatural = { D: 0, I: 0, S: 0, C: 0 };
        const countsAdapted = { D: 0, I: 0, S: 0, C: 0 };

        blocks.forEach(block => {
            block.items.forEach(item => {
                if (item.profile === 'N') countsNatural[item.factor] += 1;
                else countsAdapted[item.factor] += 1;
            });
        });

        // Calcula os escores brutos a partir das seleções (+1 / -1)
        blocks.forEach((block, bIndex) => {
            const sel = selections[bIndex];
            if (!sel) return;

            ['moreIndex', 'lessIndex'].forEach((key) => {
                const idx = sel[key];
                if (idx === null || idx === undefined) return;

                const item = block.items[idx];
                const delta = key === 'moreIndex' ? 1 : -1;

                if (item.profile === 'N') {
                    scoresNatural[item.factor] += delta;
                } else {
                    scoresAdapted[item.factor] += delta;
                }
            });
        });

        const factors = ['D', 'I', 'S', 'C'];

        function factorLabel(f) {
            switch (f) {
                case 'D': return 'D – Dominância';
                case 'I': return 'I – Influência';
                case 'S': return 'S – Estabilidade';
                case 'C': return 'C – Conformidade';
                default: return f;
            }
        }

        function factorWord(f) {
            switch (f) {
                case 'D': return 'Dominância';
                case 'I': return 'Influência';
                case 'S': return 'Estabilidade';
                case 'C': return 'Conformidade';
                default: return f;
            }
        }

        // Monta combinações tipo "SC", "IS" considerando fatores dominantes
        // Regra: sempre inclui o fator principal; adiciona outros fatores com escore >= 55
        // e que estejam até 10 pontos abaixo do principal.
        function buildCombo(sortedLetters, scaled) {
            const primary = sortedLetters[0];
            const letters = [primary];
            const topScore = scaled[primary];

            for (let i = 1; i < sortedLetters.length; i++) {
                const f = sortedLetters[i];
                const score = scaled[f];
                if (score >= 55 && (topScore - score) <= 10) {
                    letters.push(f);
                }
            }

            const code = letters.join('');
            const desc = letters.map(factorWord).join(' + ');
            return { code, desc, letters };
        }

        // Ipsative scaling block
        const natScaled = {};
        const adpScaled = {};

        factors.forEach(f => {
            const nCount = countsNatural[f];
            const aCount = countsAdapted[f];

            const rawN = scoresNatural[f];
            const rawA = scoresAdapted[f];

            if (nCount === 0) natScaled[f] = 50;
            else natScaled[f] = Math.round(((rawN + nCount) / (2 * nCount)) * 100);

            if (aCount === 0) adpScaled[f] = 50;
            else adpScaled[f] = Math.round(((rawA + aCount) / (2 * aCount)) * 100);
        });

        function sortedFactorsBy(percentages) {
            return factors.slice().sort((a, b) => percentages[b] - percentages[a]);
        }

        const natSorted = sortedFactorsBy(natScaled);
        const adpSorted = sortedFactorsBy(adpScaled);

        const natCombo = buildCombo(natSorted, natScaled);
        const adpCombo = buildCombo(adpSorted, adpScaled);

        function relativeLevel(percent) {
            if (percent >= 70) return 'muito elevado';
            if (percent >= 55) return 'elevado';
            if (percent >= 40) return 'moderado';
            if (percent >= 25) return 'reduzido';
            return 'residual';
        }

        const natLevels = {};
        const adpLevels = {};
        factors.forEach(f => {
            natLevels[f] = relativeLevel(natScaled[f]);
            adpLevels[f] = relativeLevel(adpScaled[f]);
        });

        function describeFactor(f, natPct, adpPct) {
            const natLevel = natLevels[f];
            const adpLevel = adpLevels[f];

            let base = '';

            if (f === 'D') {
                base = `
                        <p><strong>${factorLabel(f)}</strong> apresenta, no perfil natural, nível <strong>${natLevel}</strong>
                        (índice aproximado: ${natPct}/100). Isso se relaciona à tendência a tomar decisões, enfrentar problemas
                        diretamente e assumir responsabilidade por resultados.</p>
                        <p>No perfil adaptado, o nível é <strong>${adpLevel}</strong> (índice aproximado: ${adpPct}/100).
                        Intensidades mais altas de Dominância sugerem postura firme, foco em metas e maior tolerância a conflito.
                        Intensidades mais baixas indicam estilo mais cauteloso, que tende a compartilhar decisões e evitar embates
                        desnecessários.</p>
                    `;
            } else if (f === 'I') {
                base = `
                        <p><strong>${factorLabel(f)}</strong> aparece, no perfil natural, em nível <strong>${natLevel}</strong>
                        (índice aproximado: ${natPct}/100). Isso reflete a disposição para interagir, influenciar por meio de
                        comunicação e criar conexões.</p>
                        <p>No perfil adaptado, o nível é <strong>${adpLevel}</strong> (índice aproximado: ${adpPct}/100).
                        Quanto mais forte a Influência, maior a tendência a se expor, envolver pessoas e usar diálogo para
                        engajar. Intensidades mais discretas indicam comunicação mais contida e foco maior em tarefas do que em
                        relacionamento.</p>
                    `;
            } else if (f === 'S') {
                base = `
                        <p><strong>${factorLabel(f)}</strong> surge, no perfil natural, em nível <strong>${natLevel}</strong>
                        (índice aproximado: ${natPct}/100). Esse fator se relaciona à preferência por estabilidade, ritmo constante,
                        paciência e apoio às pessoas.</p>
                        <p>No perfil adaptado, o nível é <strong>${adpLevel}</strong> (índice aproximado: ${adpPct}/100).
                        Intensidades elevadas de Estabilidade indicam busca por ambientes previsíveis e relações de confiança.
                        Intensidades mais baixas sugerem maior conforto com mudança, variação e ajustes frequentes de rota.</p>
                    `;
            } else if (f === 'C') {
                base = `
                        <p><strong>${factorLabel(f)}</strong> aparece, no perfil natural, em nível <strong>${natLevel}</strong>
                        (índice aproximado: ${natPct}/100). Ele expressa o quanto a pessoa valoriza regras, padrões, qualidade e
                        análise cuidadosa.</p>
                        <p>No perfil adaptado, o nível é <strong>${adpLevel}</strong> (índice aproximado: ${adpPct}/100).
                        Intensidades mais fortes de Conformidade indicam atenção a detalhes, procedimentos e riscos.
                        Intensidades menores indicam maior flexibilidade, maior tolerância a improvisos e foco em agilidade.</p>
                    `;
            }

            const diff = adpPct - natPct;
            let adj = '';
            if (Math.abs(diff) >= 10) {
                if (diff > 0) {
                    adj = `<p><em>Há um aumento perceptível deste fator no contexto adaptado em relação ao natural.
                        Isso pode indicar que o ambiente atual estimula ou exige mais comportamentos associados a esse
                        estilo, gerando uma atuação mais intensa nesse eixo.</em></p>`;
                } else {
                    adj = `<p><em>Nota-se uma redução perceptível deste fator no perfil adaptado em comparação com o
                        natural. Isso pode significar que o contexto atual não favorece plenamente o uso deste estilo,
                        ou que outras demandas estão sendo priorizadas.</em></p>`;
                }
            }

            return `<div class="disc-detail-body">${base}${adj}</div>`;
        }

        const adaptedGraphHTML = `
                <div class="disc-single-graph">
                    <div class="disc-graph-header">
                        <div class="disc-graph-title">Estilo Adaptado</div>
                        <div class="disc-graph-subtitle">Resposta ao contexto atual</div>
                    </div>
                    <div class="disc-graph-bars-row">
                        ${factors.map(f => `
                            <div class="disc-graph-bar">
                                <div class="disc-graph-bar-inner ${f}" style="height: ${adpScaled[f]}%;"></div>
                                <div class="disc-graph-bar-label">${factorLabel(f).split('–')[0].trim()}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="disc-graph-values-row">
                        ${factors.map(f => `
                            <div class="disc-factor-circle ${f}">${adpScaled[f]}</div>
                        `).join('')}
                    </div>
                </div>
            `;

        const naturalGraphHTML = `
                <div class="disc-single-graph">
                    <div class="disc-graph-header">
                        <div class="disc-graph-title">Estilo Natural</div>
                        <div class="disc-graph-subtitle">Tendência espontânea</div>
                    </div>
                    <div class="disc-graph-bars-row">
                        ${factors.map(f => `
                            <div class="disc-graph-bar">
                                <div class="disc-graph-bar-inner ${f}" style="height: ${natScaled[f]}%;"></div>
                                <div class="disc-graph-bar-label">${factorLabel(f).split('–')[0].trim()}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="disc-graph-values-row">
                        ${factors.map(f => `
                            <div class="disc-factor-circle ${f}">${natScaled[f]}</div>
                        `).join('')}
                    </div>
                </div>
            `;

        const graphsHTML = `
                <div class="disc-chart-title">Intensidade relativa por fator</div>
                <div class="disc-graphs-wrapper">
                    ${naturalGraphHTML}
                    ${adaptedGraphHTML}
                </div>
            `;

        // Cartões detalhados por fator, com borda colorida
        const detailsCardsHTML = `
                <div class="disc-details-grid">
                    ${factors.map(f => `
                        <div class="disc-detail-card ${f}">
                            <div class="disc-detail-avatar ${f}">${f}</div>
                            <div class="disc-detail-content">
                                <div class="disc-detail-title">${factorLabel(f)}</div>
                                ${describeFactor(f, natScaled[f], adpScaled[f])}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

        const commGuideHTML = `
                <div class="disc-comm-section">
                    <h3>Guia rápido de comunicação por perfil</h3>
                    <p class="small-note">
                        Sugestões lúdicas de como ajustar sua comunicação ao estilo predominante da pessoa. Use como inspiração,
                        sempre em conjunto com sua própria observação e bom senso.
                    </p>
                    <div class="disc-comm-grid">
                        <div class="disc-comm-card D">
                            <div class="disc-comm-avatar D">D</div>
                            <div class="disc-comm-body">
                                <div class="disc-comm-title">Perfil Dominância (vermelho)</div>
                                <div class="disc-comm-subtitle">Focado em resultados, rapidez e decisão.</div>
                                <ul class="disc-comm-list">
                                    <li><strong>Faça:</strong> seja direto, objetivo e apresente rapidamente os resultados esperados.</li>
                                    <li><strong>Faça:</strong> ofereça desafios e espaço para autonomia nas decisões.</li>
                                    <li><strong>Evite:</strong> rodeios, excesso de detalhes irrelevantes e indecisão prolongada.</li>
                                    <li><strong>Evite:</strong> microgestão e discussões longas sem encaminhamento claro.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="disc-comm-card I">
                            <div class="disc-comm-avatar I">I</div>
                            <div class="disc-comm-body">
                                <div class="disc-comm-title">Perfil Influência (amarelo)</div>
                                <div class="disc-comm-subtitle">Voltado para pessoas, ideias e entusiasmo.</div>
                                <ul class="disc-comm-list">
                                    <li><strong>Faça:</strong> use um tom positivo, reconheça contribuições e crie espaço para interação.</li>
                                    <li><strong>Faça:</strong> conecte o tema a pessoas, impacto e propósito coletivo.</li>
                                    <li><strong>Evite:</strong> comunicação excessivamente fria, distante ou apenas técnica.</li>
                                    <li><strong>Evite:</strong> cortar conversas de forma brusca ou ignorar emoções e percepções.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="disc-comm-card S">
                            <div class="disc-comm-avatar S">S</div>
                            <div class="disc-comm-body">
                                <div class="disc-comm-title">Perfil Estabilidade (verde)</div>
                                <div class="disc-comm-subtitle">Busca harmonia, previsibilidade e suporte.</div>
                                <ul class="disc-comm-list">
                                    <li><strong>Faça:</strong> explique o porquê das mudanças e ofereça segurança e clareza de passos.</li>
                                    <li><strong>Faça:</strong> demonstre respeito, escuta e consistência na forma de se relacionar.</li>
                                    <li><strong>Evite:</strong> pressões súbitas sem contexto ou mudanças constantes de última hora.</li>
                                    <li><strong>Evite:</strong> confrontos desnecessários e tom agressivo ou impaciente.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="disc-comm-card C">
                            <div class="disc-comm-avatar C">C</div>
                            <div class="disc-comm-body">
                                <div class="disc-comm-title">Perfil Conformidade (azul)</div>
                                <div class="disc-comm-subtitle">Valoriza qualidade, lógica e critérios claros.</div>
                                <ul class="disc-comm-list">
                                    <li><strong>Faça:</strong> traga dados, fundamentos e critérios, sendo específico nas solicitações.</li>
                                    <li><strong>Faça:</strong> dê tempo razoável para análise e esclareça padrões e responsabilidades.</li>
                                    <li><strong>Evite:</strong> ser vago, mudar regras com frequência ou pedir decisões sem informações mínimas.</li>
                                    <li><strong>Evite:</strong> pressionar por respostas imediatas em temas complexos sem preparo prévio.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        const reportHTML = `
                <div class="report-header">
                    <div class="report-title-main">Resultados do Questionário DISC</div>
                    <div class="report-subtitle">
                        Visão geral dos quatro fatores comportamentais em dois perfis: 
                        <strong>Natural</strong> (estilo espontâneo) e <strong>Adaptado</strong> (resposta ao contexto atual).
                    </div>
                    <div class="report-participant"><strong>Pessoa avaliada:</strong> ${participantName}</div>
                </div>

                <div class="disc-layout-grid">
                    <div class="disc-summary-panel">
                        <div class="disc-summary-row">
                            <span class="disc-summary-tag">Perfil Natural</span>
                            <div class="disc-summary-profiles">
                                <div class="disc-profile-card">
                                    <span class="disc-profile-code">${natCombo.code}</span>
                                    <div class="disc-profile-badges">
                                        ${natCombo.letters.map(l => `<span class="disc-profile-label-badge ${l}">${factorLabel(l)}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="disc-summary-row">
                            <span class="disc-summary-tag">Perfil Adaptado</span>
                            <div class="disc-summary-profiles">
                                <div class="disc-profile-card">
                                    <span class="disc-profile-code">${adpCombo.code}</span>
                                    <div class="disc-profile-badges">
                                        ${adpCombo.letters.map(l => `<span class="disc-profile-label-badge ${l}">${factorLabel(l)}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="small-note" style="margin-top: 8px;">
                            O perfil natural indica tendências comportamentais mais espontâneas. 
                            O perfil adaptado reflete como a pessoa ajusta seu estilo às demandas percebidas no ambiente.
                        </p>
                    </div>

                    <div class="disc-chart-panel">
                        ${graphsHTML}
                    </div>
                </div>

                <div class="disc-details-section">
                    <h3>Análise descritiva por fator</h3>
                    ${detailsCardsHTML}
                </div>

                ${commGuideHTML}

                <div class="disc-footer-note">
                    Este relatório é uma síntese interpretativa do instrumento DISC e deve ser lido como apoio ao
                    autoconhecimento e a conversas de desenvolvimento, não como rótulo definitivo da pessoa avaliada.
                </div>
            `;

        reportContainer.innerHTML = reportHTML;
    }
</script>
</body>
</html>